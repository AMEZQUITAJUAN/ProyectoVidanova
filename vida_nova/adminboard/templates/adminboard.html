{% extends 'layout.html' %}
{% load static %}

{% block title %}{% endblock %}

{% block content %}
    <link href="{% static 'css/adminboard.css' %}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h2>Tablero Administrativo</h2>
            </div>
            
            <div class="header-right">
                <div class="user-menu">
                    <div class="user-info">
                        <span class="user-name">Admin Usuario</span>
                        <span class="user-role">Super Administrador</span>
                    </div>
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filtros -->
        <section class="vn-card filters-card">
            <h2 class="card-title">
                <i class="fas fa-filter"></i>
                Filtros
            </h2>
            <form class="filters">
                <div class="grid-4">
                    <div class="form-group">
                        <label for="date_from">Desde</label>
                        <input type="date" id="date_from" name="date_from" value="2024-01-01">
                    </div>
                    <div class="form-group">
                        <label for="date_to">Hasta</label>
                        <input type="date" id="date_to" name="date_to" value="2024-12-31">
                    </div>
                    <div class="form-group">
                        <label for="status">Estado de la Solicitud</label>
                        <select id="status" name="status">
                            <option value="">Todos</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en_gestion">En gestión</option>
                            <option value="por_gestionar">Por gestionar</option>
                            <option value="agendado">Agendado</option>
                            <option value="realizado">Realizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="procedure">Tipo de Procedimiento</label>
                        <select id="procedure" name="procedure">
                            <option value="">Todos</option>
                            <option value="oncologia">Oncología</option>
                            <option value="cirugia">Cirugía</option>
                            <option value="radioterapia">Radioterapia</option>
                            <option value="quimioterapia">Quimioterapia</option>
                        </select>
                    </div>
                </div>
                <div class="filters-actions">
                    <button class="btn primary" type="submit">
                        <i class="fas fa-search"></i>
                        Aplicar
                    </button>
                    <button class="btn ghost" type="button">
                        <i class="fas fa-times"></i>
                        Limpiar
                    </button>
                </div>
            </form>
        </section>

        <!-- KPI Cards -->
        <section class="kpi-grid">
            <div class="vn-card kpi blue">
                <div class="kpi-header">
                    <h3>Total Ordenar</h3>
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <div class="kpi-value">156</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12%</span>
                </div>
            </div>
            
            <div class="vn-card kpi purple">
                <div class="kpi-header">
                    <h3>Realizados</h3>
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="kpi-value">89</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+8%</span>
                </div>
            </div>
            
            <div class="vn-card kpi teal">
                <div class="kpi-header">
                    <h3>Agendados</h3>
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="kpi-value">42</div>
                <div class="kpi-trend neutral">
                    <i class="fas fa-minus"></i>
                    <span>0%</span>
                </div>
            </div>
            
            <div class="vn-card kpi pink">
                <div class="kpi-header">
                    <h3>Pendientes</h3>
                    <i class="fas fa-clock"></i>
                </div>
                <div class="kpi-value">25</div>
                <div class="kpi-trend down">
                    <i class="fas fa-arrow-down"></i>
                    <span>-5%</span>
                </div>
            </div>
            
            <div class="vn-card kpi gray">
                <div class="kpi-header">
                    <h3>Promedio Días</h3>
                    <i class="fas fa-stopwatch"></i>
                </div>
                <div class="kpi-value">7.2</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+1.2</span>
                </div>
            </div>
        </section>

        <!-- Gráficas -->
        <section class="grid-2">
            <div class="vn-card chart-card">
                <h2 class="card-title">
                    <i class="fas fa-pie-chart"></i>
                    Estado de la Solicitud
                </h2>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            
            <div class="vn-card chart-card">
                <h2 class="card-title">
                    <i class="fas fa-bar-chart"></i>
                    Oportunidad por Procedimiento
                </h2>
                <div class="chart-container">
                    <canvas id="opChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Workflow Visual -->
        <section class="vn-card workflow-card">
            <h2 class="card-title">
                <i class="fas fa-sitemap"></i>
                Flujo de Gestión
            </h2>
            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-label">Total Ordenar</div>
                </div>
                
                <div class="workflow-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-label">Pendiente</div>
                    <div class="step-percentage">2%</div>
                </div>
                
                <div class="workflow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-label">En gestión</div>
                </div>
                
                <div class="workflow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-label">Por gestionar</div>
                </div>
                
                <div class="workflow-side">
                    <div class="workflow-step">
                        <div class="step-number">2</div>
                        <div class="step-label">Agendas</div>
                        <div class="step-percentage">2%</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabla detalle -->
        <section class="vn-card table-card">
            <h2 class="card-title">
                <i class="fas fa-table"></i>
                Detalle por Solicitud
            </h2>
            <div class="table-wrap">
                <table class="vn-table">
                    <thead>
                        <tr>
                            <th>
                                <i class="fas fa-user"></i>
                                Paciente
                            </th>
                            <th>
                                <i class="fas fa-stethoscope"></i>
                                Tipo de Procedimiento
                            </th>
                            <th>
                                <i class="fas fa-info-circle"></i>
                                Estado
                            </th>
                            <th>
                                <i class="fas fa-calendar"></i>
                                Fecha Solicitud
                            </th>
                            <th>
                                <i class="fas fa-calendar-check"></i>
                                Fecha Cita
                            </th>
                            <th>
                                <i class="fas fa-clock"></i>
                                Días
                            </th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-avatar">MP</div>
                                    <div>
                                        <strong>María Pérez</strong>
                                        <small>ID: 12345</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="procedure-badge oncologia">Oncología</span>
                            </td>
                            <td>
                                <span class="status-badge pendiente">Pendiente</span>
                            </td>
                            <td>15/01/2024</td>
                            <td>22/01/2024</td>
                            <td class="num">7</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon primary" title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon secondary" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-avatar">JG</div>
                                    <div>
                                        <strong>Juan García</strong>
                                        <small>ID: 12346</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="procedure-badge cirugia">Cirugía</span>
                            </td>
                            <td>
                                <span class="status-badge realizado">Realizado</span>
                            </td>
                            <td>10/01/2024</td>
                            <td>18/01/2024</td>
                            <td class="num">8</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon primary" title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon secondary" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-avatar">AL</div>
                                    <div>
                                        <strong>Ana López</strong>
                                        <small>ID: 12347</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="procedure-badge radioterapia">Radioterapia</span>
                            </td>
                            <td>
                                <span class="status-badge agendado">Agendado</span>
                            </td>
                            <td>20/01/2024</td>
                            <td>25/01/2024</td>
                            <td class="num">5</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon primary" title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon secondary" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div><script>
        // Inicialización del Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            initializeSidebar();
            initializeFilters();
        });

        // Toggle Sidebar para móviles
        function initializeSidebar() {
            const menuToggle = document.querySelector('.menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            
            menuToggle?.addEventListener('click', function() {
                sidebar.classList.toggle('open');
            });
            
            // Cerrar sidebar al hacer click fuera en móvil
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 968 && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            });
        }

        // Inicializar filtros
        function initializeFilters() {
            const form = document.querySelector('.filters');
            const clearButton = form?.querySelector('.btn.ghost');
            
            clearButton?.addEventListener('click', function(e) {
                e.preventDefault();
                form.reset();
                // Aquí podrías disparar una actualización de datos
                console.log('Filtros limpiados');
            });
        }

        // Inicializar gráficas
        function initializeCharts() {
            // Configuración común para los colores Vidanova
            const vidanovaColors = {
                primary: '#183ad6',
                secondary: '#3D54A1',
                tertiary: '#2f5f98',
                dark: '#0F2D47',
                purple: '#8f4392',
                pink: '#cc9cc8',
                gray: '#706f6f',
                grayLight: '#888888'
            };

            // Gráfica de Estado de Solicitudes (Pie Chart)
            const statusCtx = document.getElementById('statusChart')?.getContext('2d');
            if (statusCtx) {
                new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Realizados', 'Agendados', 'Pendientes', 'En Gestión', 'Por Gestionar'],
                        datasets: [{
                            data: [89, 42, 25, 15, 10],
                            backgroundColor: [
                                vidanovaColors.primary,
                                vidanovaColors.tertiary,
                                '#f59e0b',
                                vidanovaColors.purple,
                                '#ef4444'
                            ],
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            hoverBorderWidth: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: vidanovaColors.dark,
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: vidanovaColors.primary,
                                borderWidth: 2,
                                cornerRadius: 8,
                                displayColors: true,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: ${context.parsed} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        animation: {
                            animateScale: true,
                            duration: 1500,
                            easing: 'easeInOutCubic'
                        }
                    }
                });
            }

            // Gráfica de Oportunidad por Procedimiento (Bar Chart)
            const opCtx = document.getElementById('opChart')?.getContext('2d');
            if (opCtx) {
                new Chart(opCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Oncología', 'Cirugía', 'Radioterapia', 'Quimioterapia', 'Consulta'],
                        datasets: [{
                            label: 'Días promedio',
                            data: [7.2, 5.8, 8.1, 6.3, 4.2],
                            backgroundColor: [
                                vidanovaColors.primary,
                                vidanovaColors.purple,
                                vidanovaColors.tertiary,
                                vidanovaColors.pink,
                                vidanovaColors.secondary
                            ],
                            borderColor: [
                                vidanovaColors.primary,
                                vidanovaColors.purple,
                                vidanovaColors.tertiary,
                                vidanovaColors.pink,
                                vidanovaColors.secondary
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: vidanovaColors.dark,
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: vidanovaColors.primary,
                                borderWidth: 2,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function(context) {
                                        return `Promedio: ${context.parsed.y} días`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#e2e8f0',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: vidanovaColors.gray,
                                    font: {
                                        size: 11,
                                        weight: '500'
                                    },
                                    callback: function(value) {
                                        return value + ' días';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: vidanovaColors.gray,
                                    font: {
                                        size: 11,
                                        weight: '600'
                                    },
                                    maxRotation: 45
                                }
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutCubic'
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }
        }

        // Funciones auxiliares para actualización dinámica de datos
        function updateKPIs(data) {
            // Actualizar valores KPI dinámicamente
            document.querySelector('.kpi.blue .kpi-value').textContent = data.totalOrdenar || '156';
            document.querySelector('.kpi.purple .kpi-value').textContent = data.realizados || '89';
            document.querySelector('.kpi.teal .kpi-value').textContent = data.agendados || '42';
            document.querySelector('.kpi.pink .kpi-value').textContent = data.pendientes || '25';
            document.querySelector('.kpi.gray .kpi-value').textContent = data.promedioDias || '7.2';
        }

        // Función para mostrar estado de carga
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `
                    <div class="chart-loading">
                        <div class="loading-spinner"></div>
                        <span style="margin-left: 1rem;">Cargando datos...</span>
                    </div>
                `;
            }
        }

        // Simular carga de datos (reemplazar con llamadas reales a la API)
        function loadDashboardData() {
            // Mostrar loading
            showLoading('statusChart');
            showLoading('opChart');
            
            // Simular delay de API
            setTimeout(() => {
                initializeCharts();
            }, 1500);
        }

        // Event listeners adicionales
        document.addEventListener('DOMContentLoaded', function() {
            // Animaciones de entrada para las cards KPI
            const kpiCards = document.querySelectorAll('.kpi');
            kpiCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });

            // Tooltips para botones de acción
            const actionButtons = document.querySelectorAll('.btn-icon');
            actionButtons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    const title = this.getAttribute('title');
                    if (title) {
                        // Aquí podrías implementar tooltips personalizados
                        console.log('Tooltip:', title);
                    }
                });
            });

            // Búsqueda en tiempo real para la tabla (si necesitas implementarla)
            const searchInput = document.querySelector('#searchInput'); // Si agregas un input de búsqueda
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const tableRows = document.querySelectorAll('.vn-table tbody tr');
                    
                    tableRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                });
            }
        });
    </script>
</body>
</html>
{% endblock %}