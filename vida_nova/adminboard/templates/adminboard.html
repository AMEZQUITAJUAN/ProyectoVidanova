{% extends 'layout.html' %}
{% load static %}

{% block title %}{% endblock %}

{% block content %}
    <link href="{% static 'css/adminboard.css' %}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="section">
            <div class="card">
                <h1><i class="fas fa-chart-line"></i> Tablero Administrativo</h1>
            </div>
        </header>

        <!-- Filtros -->
        <section class="section">
            <div class="card">
                <h2><i class="fas fa-filter"></i> Filtros</h2>
                <form class="filters">
                    <div class="grid-4" style="margin-top: 16px;">
                        <div class="form-group">
                            <label for="date_from">Desde</label>
                            <input type="date" id="date_from" name="date_from" value="2024-01-01">
                        </div>
                        <div class="form-group">
                            <label for="date_to">Hasta</label>
                            <input type="date" id="date_to" name="date_to" value="2024-12-31">
                        </div>
                        <div class="form-group">
                            <label for="status">Estado de la Solicitud</label>
                            <select id="status" name="status">
                                <option value="">Todos</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="en_gestion">En gestión</option>
                                <option value="por_gestionar">Por gestionar</option>
                                <option value="agendado">Agendado</option>
                                <option value="realizado">Realizado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="procedure">Tipo de Procedimientos</label>
                            <select id="procedure" name="procedure">
                                <option value="">Todos</option>
                                <option value="oncologia">Oncología</option>
                                <option value="cirugia">Cirugía</option>
                                <option value="radioterapia">Radioterapia</option>
                                <option value="quimioterapia">Quimioterapia</option>
                                <option value="consulta">Consulta</option>
                                <option value="imagenes">Imágenes</option>
                                <option value="laboratorio">Laboratorio</option>
                                <option value="patologia">Patología</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Sección Agendamientos -->
                    <div style="margin-top: 24px;">
                        <h3>Agendamientos</h3>
                        <div class="grid-4" style="margin-top: 12px;">
                            <div class="form-group">
                                <label for="appointment_type">Tipo de Paciente</label>
                                <select id="appointment_type" name="appointment_type">
                                    <option value="">Todos</option>
                                    <option value="nuevo">Nuevo</option>
                                    <option value="control">Control</option>
                                    <option value="seguimiento">Seguimiento</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="priority">Prioridad</label>
                                <select id="priority" name="priority">
                                    <option value="">Todas</option>
                                    <option value="alta">Alta</option>
                                    <option value="media">Media</option>
                                    <option value="baja">Baja</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filters-actions" style="margin-top: 20px;">
                        <button class="btn primary" type="submit">
                            <i class="fas fa-search"></i> Aplicar
                        </button>
                        <button class="btn secondary" type="button">
                            <i class="fas fa-times"></i> Limpiar
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Tiempos Críticos -->
        <section class="section">
            <div class="card">
                <h2><i class="fas fa-exclamation-triangle"></i> Tiempos críticos:</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
                    <div class="alert critical">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 24px;"></i>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">2</div>
                                <div>Alerta Crítica</div>
                            </div>
                        </div>
                    </div>
                    <div class="alert warning">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-clock" style="font-size: 24px;"></i>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">3</div>
                                <div>Advertencia</div>
                            </div>
                        </div>
                    </div>
                    <div class="alert success">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-check-circle" style="font-size: 24px;"></i>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">4</div>
                                <div>En Tiempo</div>
                            </div>
                        </div>
                    </div>
                    <div class="alert info">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-list" style="font-size: 24px;"></i>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">9</div>
                                <div>Total Casos</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <button class="btn secondary">
                        <i class="fas fa-search"></i> Buscar Paciente o Tipo de caso
                    </button>
                </div>
            </div>
        </section>

        <!-- KPI Grid -->
        <section class="section">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <!-- Total Ordenar -->
                <div class="card" style="text-align: center; border-top: 4px solid #3b82f6;">
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">Total Ordenar</div>
                    <div style="font-size: 36px; font-weight: bold; color: #1f2937;">156</div>
                    <div style="font-size: 12px; color: #6b7280;">12%</div>
                </div>
                
                <!-- Realizados -->
                <div class="card" style="text-align: center; border-top: 4px solid #10b981;">
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">Realizados</div>
                    <div style="font-size: 36px; font-weight: bold; color: #1f2937;">89</div>
                    <div style="font-size: 12px; color: #6b7280;">10%</div>
                </div>
                
                <!-- Total Ordenar (duplicado) -->
                <div class="card" style="text-align: center; border-top: 4px solid #3b82f6;">
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">Total Ordenar</div>
                    <div style="font-size: 36px; font-weight: bold; color: #1f2937;">156</div>
                    <div style="font-size: 12px; color: #6b7280;">15%</div>
                </div>
                
                <!-- Total Ordenar (otro) -->
                <div class="card" style="text-align: center; border-top: 4px solid #f59e0b;">
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">Total Ordenar</div>
                    <div style="font-size: 36px; font-weight: bold; color: #1f2937;">156</div>
                    <div style="font-size: 12px; color: #6b7280;">15%</div>
                </div>
                
                <!-- Promedio Días -->
                <div class="card" style="text-align: center; border-top: 4px solid #8b5cf6;">
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">Promedio Días</div>
                    <div style="font-size: 36px; font-weight: bold; color: #1f2937;">7.2</div>
                    <div style="font-size: 12px; color: #6b7280;">7.2</div>
                </div>
            </div>
        </section>

        <!-- Gráficas -->
        <section class="section">
            <div class="grid-2">
                <div class="card">
                    <h3><i class="fas fa-pie-chart"></i> Estado de la Solicitud</h3>
                    <div style="height: 300px; margin-top: 16px;">
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div style="margin-top: 16px; font-size: 12px; color: #6b7280;">
                        <span style="display: inline-block; width: 12px; height: 12px; background: #3b82f6; border-radius: 2px; margin-right: 8px;"></span>Pendiente
                        <span style="display: inline-block; width: 12px; height: 12px; background: #10b981; border-radius: 2px; margin-left: 16px; margin-right: 8px;"></span>Agendado
                        <span style="display: inline-block; width: 12px; height: 12px; background: #f59e0b; border-radius: 2px; margin-left: 16px; margin-right: 8px;"></span>Realizado
                        <span style="display: inline-block; width: 12px; height: 12px; background: #ef4444; border-radius: 2px; margin-left: 16px; margin-right: 8px;"></span>Por Gestionar
                    </div>
                </div>
                
                <div class="card">
                    <h3><i class="fas fa-bar-chart"></i> Oportunidad por Procedimientos</h3>
                    <div style="height: 300px; margin-top: 16px;">
                        <canvas id="procedureChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Barreras y Próximas IPS -->
        <section class="section">
            <div class="grid-2">
                <div class="card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Barreras</h3>
                    <div style="margin-top: 16px;">
                        <div style="margin-bottom: 12px;">
                            <strong>Falta del paciente:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Pacientes que no asisten a sus citas programadas</span>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <strong>Disponibilidad:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Limitaciones en horarios y recursos disponibles</span>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <strong>Demora de la IPS:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Retrasos en el sistema de salud institucional</span>
                        </div>
                        <div>
                            <strong>Otras (especificar):</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Factores adicionales que afectan los procesos</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i class="fas fa-hospital"></i> Próximas de IPS</h3>
                    <div style="margin-top: 16px;">
                        <div style="margin-bottom: 12px;">
                            <strong>Solicitar citas de IPS:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Gestión de nuevas citas médicas especializadas</span>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <strong>Solicitar procedimientos de IPS:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Coordinación de procedimientos específicos</span>
                        </div>
                        <div>
                            <strong>Solicitar o medicamentos IPS:</strong><br>
                            <span style="color: #6b7280; font-size: 14px;">Gestión de prescripciones y medicamentos especializados</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabla de Pacientes -->
        <section class="section">
            <div class="card">
                <h2><i class="fas fa-users"></i> Detalle por Pacientes</h2>
                <div style="overflow-x: auto; margin-top: 16px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Paciente</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Tipo de Procedimientos</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">CUPS</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Servicio Solicitado</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Estado</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Barreras</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Fecha Solicitud</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Fecha Cita</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Días</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 32px; height: 32px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">MP</div>
                                        <div>
                                            <div style="font-weight: 600;">María Pérez</div>
                                            <div style="font-size: 12px; color: #6b7280;">ID: 12345</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #dbeafe; color: #1d4ed8; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">ONCOLOGÍA</span>
                                </td>
                                <td style="padding: 12px; font-family: monospace;">890278</td>
                                <td style="padding: 12px;">
                                    <div style="font-size: 13px;">
                                        <div>Consulta de primera vez por</div>
                                        <div>especialista en oncología</div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #fef3c7; color: #d97706; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">PENDIENTE</span>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="font-size: 12px; color: #6b7280;">Disponibilidad del paciente</span>
                                </td>
                                <td style="padding: 12px; font-size: 13px;">14/01/2024</td>
                                <td style="padding: 12px; font-size: 13px;">22/01/2024</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">7</td>
                                <td style="padding: 12px;">
                                    <div style="display: flex; gap: 4px;">
                                        <button class="btn" style="padding: 6px 8px; background: #3b82f6; color: white; border-radius: 4px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn" style="padding: 6px 8px; background: #6b7280; color: white; border-radius: 4px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">JG</div>
                                        <div>
                                            <div style="font-weight: 600;">Juan García</div>
                                            <div style="font-size: 12px; color: #6b7280;">ID: 12346</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #fecaca; color: #dc2626; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">CIRUGÍA</span>
                                </td>
                                <td style="padding: 12px; font-family: monospace;">890278</td>
                                <td style="padding: 12px;">
                                    <div style="font-size: 13px;">
                                        <div>consulta de</div>
                                        <div>control de</div>
                                        <div>cirugía general</div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #dcfce7; color: #16a34a; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">REALIZADO</span>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="font-size: 12px; color: #6b7280;">Ninguna</span>
                                </td>
                                <td style="padding: 12px; font-size: 13px;">10/01/2024</td>
                                <td style="padding: 12px; font-size: 13px;">18/01/2024</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">8</td>
                                <td style="padding: 12px;">
                                    <div style="display: flex; gap: 4px;">
                                        <button class="btn" style="padding: 6px 8px; background: #3b82f6; color: white; border-radius: 4px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn" style="padding: 6px 8px; background: #6b7280; color: white; border-radius: 4px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 32px; height: 32px; background: #f59e0b; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">AL</div>
                                        <div>
                                            <div style="font-weight: 600;">Ana López</div>
                                            <div style="font-size: 12px; color: #6b7280;">ID: 12347</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #e0e7ff; color: #3730a3; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">RADIOTERAPIA</span>
                                </td>
                                <td style="padding: 12px; font-family: monospace;">966004</td>
                                <td style="padding: 12px;">
                                    <div style="font-size: 13px;">
                                        <div>consulta de primera vez por</div>
                                        <div>especialista en oncología</div>
                                        <div style="color: #6b7280; margin-top: 4px;">antígeno de</div>
                                        <div style="color: #6b7280;">cáncer de mama</div>
                                        <div style="color: #6b7280; margin-top: 4px;">15-3+determinación</div>
                                        <div style="color: #6b7280;">sangre o</div>
                                        <div style="color: #6b7280;">suero</div>
                                    </div>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="background: #ddd6fe; color: #5b21b6; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">AGENDADO</span>
                                </td>
                                <td style="padding: 12px;">
                                    <span style="font-size: 12px; color: #6b7280;">Demora en la agenda</span>
                                </td>
                                <td style="padding: 12px; font-size: 13px;">20/01/2024</td>
                                <td style="padding: 12px; font-size: 13px;">25/01/2024</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">5</td>
                                <td style="padding: 12px;">
                                    <div style="display: flex; gap: 4px;">
                                        <button class="btn" style="padding: 6px 8px; background: #3b82f6; color: white; border-radius: 4px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn" style="padding: 6px 8px; background: #6b7280; color: white; border-radius: 4px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Inicialización básica de gráficas
        document.addEventListener('DOMContentLoaded', function() {
            // Gráfica de Estado (Donut)
            const statusCtx = document.getElementById('statusChart')?.getContext('2d');
            if (statusCtx) {
                new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Pendiente', 'Agendado', 'Realizado', 'Por Gestionar'],
                        datasets: [{
                            data: [25, 42, 89, 10],
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Gráfica de Procedimientos (Bar)
            const procedureCtx = document.getElementById('procedureChart')?.getContext('2d');
            if (procedureCtx) {
                new Chart(procedureCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Oncología', 'Cirugía', 'Radioterapia', 'Quimioterapia', 'Consulta', 'Imágenes', 'Lab', 'Patología'],
                        datasets: [{
                            label: 'Días promedio',
                            data: [7.2, 5.8, 8.1, 6.3, 4.2, 5.5, 3.8, 6.9],
                            backgroundColor: ['#3b82f6', '#dc2626', '#3730a3', '#059669', '#d97706', '#7c3aed', '#0891b2', '#be185d']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
{% endblock %}